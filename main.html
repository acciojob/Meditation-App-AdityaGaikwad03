<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zen Flow Meditation</title>

    <!-- ✅ Correct Tailwind CSS Link -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- ✅ Inter Font Import -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }

        /* Background video container */
        .vid-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .vid-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 1s ease-in-out;
        }

        #app {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(2px);
            min-height: 100vh;
        }

        .player-svg {
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .player-svg:hover {
            transform: scale(1.05);
        }

        .sound-picker button {
            transition: all 0.3s ease;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
        }

        .sound-picker button.active {
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.5);
        }

        #time-select button {
            transition: background-color 0.2s, transform 0.1s;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        #time-select button:hover {
            transform: translateY(-2px);
            background-color: rgba(255, 255, 255, 0.1);
        }

        #time-select button.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: white;
            font-weight: bold;
        }

        .spinner {
            stroke-dasharray: 452;
            stroke-dashoffset: 452;
            transition: stroke-dashoffset 0.1s linear;
        }
    </style>

    <!-- ✅ Correct Phosphor Icons Link -->
    <script src="https://unpkg.com/phosphor-icons"></script>
</head>

<body class="bg-gray-900 text-white">

    <div id="app" class="app flex flex-col items-center justify-center min-h-screen p-4 md:p-8">

        <!-- 🌊 Video Backgrounds -->
        <div class="vid-container">
            <video loop muted autoplay id="beach-video" src="Videos/beach.mp4" class="opacity-100"
                onerror="this.style.filter='grayscale(100%) blur(10px)'; console.warn('Beach video not found.');"></video>
            <video loop muted autoplay id="rain-video" src="Videos/rain.mp4" class="opacity-0 absolute top-0 left-0"
                onerror="this.style.filter='grayscale(100%) blur(10px)'; console.warn('Rain video not found.');"></video>
        </div>

        <!-- 🧘 Player Section -->
        <div class="player-container relative flex flex-col items-center justify-center z-10 space-y-8 w-full max-w-lg">

            <div class="play relative w-48 h-48 md:w-64 md:h-64 flex items-center justify-center">
                <svg class="player-svg absolute top-0 left-0 w-full h-full transform -rotate-90" viewBox="0 0 150 150" fill="none">
                    <circle cx="75" cy="75" r="72" stroke="rgba(255,255,255,0.2)" stroke-width="6"></circle>
                    <circle class="spinner" id="timer-spinner" cx="75" cy="75" r="72" stroke="#4c51bf" stroke-width="6" stroke-linecap="round"></circle>
                </svg>

                <button class="focus:outline-none transition-transform duration-300" aria-label="Play or Pause Meditation">
                    <svg id="play-pause-icon" xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor" viewBox="0 0 256 256">
                        <path id="play-path" d="M240,128a15.7,15.7,0,0,1-7.7,13.5L88.9,235.6a16,16,0,0,1-16.1.1A15.9,15.9,0,0,1,64,222.1V33.9a15.9,15.9,0,0,1,8.8-14.9,16,16,0,0,1,16.1.1L232.3,114.5A15.7,15.7,0,0,1,240,128Z"></path>
                        <path id="pause-path" class="hidden" d="M96,48A16,16,0,0,0,80,64V192a16,16,0,0,0,32,0V64A16,16,0,0,0,96,48Zm80,0a16,16,0,0,0-16,16V192a16,16,0,0,0,32,0V64A16,16,0,0,0,176,48Z"></path>
                    </svg>
                </button>
            </div>

            <div class="time-display text-4xl font-light tracking-wider" id="time-display">10:00</div>

            <!-- Silent placeholder audio -->
            <audio id="beach-sound" class="hidden" loop src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAAABkYXRhAAAAAA=="></audio>
            <audio id="rain-sound" class="hidden" loop src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAAABkYXRhAAAAAA=="></audio>

        </div>

        <!-- 🎛️ Control Panel -->
        <div class="controls flex flex-col md:flex-row items-center justify-center gap-6 mt-8 p-4 bg-black bg-opacity-30 rounded-xl shadow-2xl">
            <div id="time-select" class="flex flex-col space-y-2">
                <button data-time="120" class="px-6 py-2 rounded-full text-sm">2 Minutes</button>
                <button data-time="300" class="px-6 py-2 rounded-full text-sm">5 Minutes</button>
                <button data-time="600" class="px-6 py-2 rounded-full text-sm active">10 Minutes</button>
            </div>

            <div class="sound-picker flex flex-row space-x-4">
                <button id="beach-mode" data-mode="beach" class="active w-16 h-16 rounded-full bg-red-500 hover:bg-red-600 flex items-center justify-center">
                    <i class="ph-sun-fill text-3xl"></i>
                </button>
                <button id="rain-mode" data-mode="rain" class="w-16 h-16 rounded-full bg-blue-500 hover:bg-blue-600 flex items-center justify-center">
                    <i class="ph-cloud-rain-fill text-3xl"></i>
                </button>
            </div>
        </div>

    </div>

    <!-- ✅ Main Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const timeDisplay = document.querySelector('.time-display');
            const playButton = document.querySelector('.play');
            const timeButtons = document.querySelectorAll('#time-select button');
            const soundButtons = document.querySelectorAll('.sound-picker button');
            const spinner = document.getElementById('timer-spinner');
            const playPath = document.getElementById('play-path');
            const pausePath = document.getElementById('pause-path');

            const beachSound = document.getElementById('beach-sound');
            const rainSound = document.getElementById('rain-sound');
            const beachVideo = document.getElementById('beach-video');
            const rainVideo = document.getElementById('rain-video');

            let totalTime = 600;
            let currentTime = 600;
            let timer = null;
            let isPlaying = false;
            let mode = 'beach';
            const circumference = 452;

            const formatTime = (s) => {
                const m = Math.floor(s / 60);
                const sec = s % 60;
                return `${m}:${sec < 10 ? '0' : ''}${sec}`;
            };

            const updateTime = () => {
                timeDisplay.textContent = formatTime(currentTime);
                spinner.style.strokeDashoffset = circumference - (currentTime / totalTime) * circumference;
                if (currentTime <= 0) stopMeditation();
            };

            const updateIcon = (play) => {
                playPath.classList.toggle('hidden', play);
                pausePath.classList.toggle('hidden', !play);
            };

            const getMedia = () => mode === 'beach' ? { sound: beachSound, video: beachVideo } : { sound: rainSound, video: rainVideo };

            const togglePlay = () => {
                const { sound, video } = getMedia();

                if (!isPlaying) {
                    sound.play().catch(() => console.warn('Autoplay blocked.'));
                    video.play().catch(() => {});
                    timer = setInterval(() => {
                        currentTime--;
                        updateTime();
                    }, 1000);
                    isPlaying = true;
                } else {
                    clearInterval(timer);
                    sound.pause();
                    video.pause();
                    isPlaying = false;
                }

                updateIcon(isPlaying);
            };

            const stopMeditation = () => {
                clearInterval(timer);
                const { sound } = getMedia();
                sound.pause();
                isPlaying = false;
                currentTime = totalTime;
                updateTime();
                updateIcon(false);
            };

            timeButtons.forEach(btn => btn.addEventListener('click', () => {
                totalTime = parseInt(btn.dataset.time);
                currentTime = totalTime;
                timeButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                updateTime();
            }));

            soundButtons.forEach(btn => btn.addEventListener('click', () => {
                const newMode = btn.dataset.mode;
                if (mode === newMode) return;
                const oldVideo = mode === 'beach' ? beachVideo : rainVideo;
                const newVideo = newMode === 'beach' ? beachVideo : rainVideo;

                oldVideo.classList.replace('opacity-100', 'opacity-0');
                newVideo.classList.replace('opacity-0', 'opacity-100');

                soundButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                mode = newMode;
            }));

            playButton.addEventListener('click', togglePlay);
            updateTime();
        });
    </script>
</body>
</html>
